<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Calculadora de NF-e</title>
    <!-- Use apenas um link para o CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>
        <div id="drop-area">
            <form class="my-form">
                <p>Clique para selecionar os arquivos</p><br>
                <input type="file" id="fileElem" multiple accept=".zip">
            </form>
        </div>

            <button id="uploadBtn" type="button">Calcular Total</button>
            <h2 id="resultado"></h2>

    <script>
        let files = [];
        const fileElem = document.getElementById("fileElem");
        const resultado = document.getElementById("resultado");

        // Atualiza o array de arquivos quando o usuÃ¡rio seleciona
        fileElem.addEventListener("change", (e) => {
            files = Array.from(e.target.files);
        });

        document.getElementById("uploadBtn").addEventListener("click", () => {
            if (files.length === 0) {
                alert("Selecione pelo menos um arquivo!");
                return;
            }

            let formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append("files[]", files[i]);
            }

            fetch("/upload", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                resultado.innerText = "Valor total: R$ " + data.total;
            })
            .catch(err => {
                console.error(err);
                alert("Ocorreu um erro ao calcular o total.");
            });
        });
    </script>
</body>
</html>
